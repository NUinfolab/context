var utils=require("kango/utils"),object=utils.object,array=utils.array,func=utils.func,EventTarget=utils.EventTarget,extensionInfo=require("kango/extension_info");function Core(){EventTarget.call(this);this._asyncModules=[];this._apiFactories={};this._moduleInitializedListener=func.bind(function(a){array.remove(this._asyncModules,a.data)},this);this.addEventListener("moduleinitialized",this._moduleInitializedListener)}
Core.prototype=object.extend(EventTarget,{init:function(){object.forEach(extensionInfo.modules,function(a){require(a)});var a=!1;this.addEventListener("moduleinitialized",func.bind(function(b){array.remove(this._asyncModules,b.data);a&&0==this._asyncModules.length&&this._fireReady()},this));this.removeEventListener("moduleinitialized",this._moduleInitializedListener);a=!0;0==this._asyncModules.length&&this._fireReady()},_fireReady:function(){this.fireEvent("ready")},dispose:function(){this.removeAllEventListeners()},
registerApiFactory:function(a,b){this._apiFactories[a]=b},createApiInstance:function(a){var b={},d={};object.forEach(this._apiFactories,function(f,e){var c=f(a);c&&(d[e]=c,b[e]=c.obj)});return{obj:b,clear:function(){object.forEach(d,function(a){a.clear()})}}},addAsyncModule:function(a){this._asyncModules.push(a)}});module.exports=new Core;
