var utils=require("kango/utils"),io=require("kango/io"),func=utils.func;function XHRRequest(){this.method="GET";this.url="";this.params={};this.headers={};this.mimeType=this.password=this.username=this.contentType="";this.sanitizeData=!1}function XHRResult(){this.response="";this.status=0}function paramsToString(a){var c="",d;for(d in a)a.hasOwnProperty(d)&&(""!=c&&(c+="&"),c+=d+"="+a[d]);return c}function XHR(){}
XHR.prototype={getXMLHttpRequest:function(){return new XMLHttpRequest},_getXMLHttpRequestEx:function(a,c){return this.getXMLHttpRequest()},send:function(a,c){var d=a.method||"GET",p="undefined"!=typeof a.async?a.async:!0,f=a.params||null,k=a.contentType||"text",g=a.url,s=a.username||null,t=a.password||null,h=a.headers||{},q=a.mimeType||null,u=a.sanitizeData||!1,e=io.isLocalUrl(g),b=this._getXMLHttpRequestEx(e,p);e&&(g=io.getExtensionFileUrl(g));var r=function(a,c){var b={response:null,status:0,abort:function(){a.abort()}};
if(2<=a.readyState&&(b.status=a.status,4==a.readyState)){if("xml"==c)b.response=a.responseXML;else if("json"==c)try{b.response=JSON.parse(a.responseText)}catch(d){}else b.response=a.responseText;b.abort=function(){}}u&&delete b.abort;return b},e=function(){return{response:null,status:0,abort:function(){}}};null!=f&&("object"==typeof a.params&&(f=paramsToString(f),"POST"==d&&(h["Content-Type"]="application/x-www-form-urlencoded")),"GET"==d&&(g=g+"?"+f,f=null));try{b.open(d,g,p,s,t)}catch(v){if(func.isCallable(c))try{c(e())}catch(l){if(-2146828218!=
l.number&&-2146823277!=l.number)throw l;}return e()}"undefined"!=typeof b.overrideMimeType&&(null!=q?b.overrideMimeType(q):"json"==k?b.overrideMimeType("application/json"):"text"==k&&b.overrideMimeType("text/plain"));b.onreadystatechange=function(){if(4==b.readyState&&func.isCallable(c))try{c(r(b,k))}catch(a){if(-2146828218!=a.number&&-2146823277!=a.number)throw a;}};if("object"==typeof h)for(var m in h)h.hasOwnProperty(m)&&b.setRequestHeader(m,h[m]);try{b.send(f)}catch(w){if(func.isCallable(c))try{c(e())}catch(n){if(-2146828218!=
n.number&&-2146823277!=n.number)throw n;}return e()}return r(b,k)}};module.exports=new XHR;module.exports.getPublicApi=function(){return utils.createApiWrapper(module.exports,XHR.prototype)};
